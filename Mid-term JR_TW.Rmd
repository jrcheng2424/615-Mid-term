---
title: "615 Mid-term"
author: "Jingrong Cheng"
date: "October 21, 2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(ggmap)
library(ggvis)
library(arm)
library(foreign)
library(maps)
library(data.table)
library(animation)
library(latticeExtra)
library(lubridate)
library(ggthemes)
cityT<-read.csv("C:/Users/Jingrong/Desktop/MSSP/615/Homework/GlobalLandTemperatures/cityT.csv")
```

1.Data cleaning
We removed all the rows with NA
```{r}
cityT <- na.omit(cityT)
#data character transformation
cityT$date<-as.Date(cityT$date,"%Y-%m-%d")
cityT$year<-as.numeric(cityT$year,"%Y")
cityT$month<-as.numeric(cityT$month,"%m")
cityT<- data.table(cityT)
# remove Hawaii & Alaska
cityT <- cityT %>%
         filter(long>=-130 & lat>=25 & lat<=55)

```

1. Location Graph
According to latitudes and longitude, i created plot of the locations of all cities in USA.
```{r}
citylocation<-subset(cityT, select = c("City","lat","long"))
citylocation<-citylocation %>% distinct(.keep_all= FALSE)

ggplot(citylocation, aes(long, lat)) +
  borders("state") +
  geom_point()+
  scale_size_area() +
  coord_quickmap()

```

2.Average Temperature per Year from 1900-2012
```{r}
#calculate mean of each year's temperature
aTy <- cityT %>%
       group_by(year) %>%
       summarise(temp=mean(AverageTemperature))

# #plot average temperature per year
ggplot(aTy, aes(x=year, y=temp)) +
  geom_jitter(aes(colour=year)) + ggtitle("US Temperature by Year") + geom_smooth() +
  labs(x="Year", y="Average Temperature")

```

3. Monthly average temperature from year 1900-2012
```{r}
# choose subset
aT <- cityT %>%
       group_by(year, month) %>%
       summarise(temp=mean(AverageTemperature))

# month trend for different year
ggplot(aT, aes(x=month, y=temp)) +
  geom_jitter(aes(colour=year)) + ggtitle("US Temperature by Month and Year") +
  labs(x="Month", y="Average Temperature")

# year trend for different month
ggplot(aT, aes(x=year, y=temp)) +
  geom_jitter(aes(colour=factor(month))) + ggtitle("US Temperature by Month and Year") +
  labs(x="Month", y="Average Temperature")
```

4. Horizonplot
let's see different cities by horizonplot
we chose Chicago, Madison, Boston, Los Angelas
```{r}
chicagoT <- cityT %>% filter(City == "Chicago")
chicago<- subset(chicagoT, year %in% c(1900,1910,1920,1930,1940,1950,1960,1970,1980,1990,2000,2010))

madisonT<- cityT %>% filter(City == "Madison")
madison <- subset(madisonT,year %in% c(1900,1910,1920,1930,1940,1950,1960,1970,1980,1990,2000,2010))

losangelesT<- cityT %>% filter(City == "Los Angeles")
losangeles<- subset(losangelesT, year %in% c(1900,1910,1920,1930,1940,1950,1960,1970,1980,1990,2000,2010))
boston<- subset(BostonT, year %in% c(1900,1910,1920,1930,1940,1950,1960,1970,1980,1990,2000,2010))
cities <- c("boston", "chicago", "losangeles", "madison")

citytable <- data.frame(boston$AverageTemperature, chicago$AverageTemperature, losangeles$AverageTemperature, madison$AverageTemperature)

colnames(citytable) <- cities

horizonplot(ts(citytable), horizonscale = 15, colorkey = TRUE)
```

5. Average Temperature per Month of City of Boston from Year 1900 to 2012
```{r}
# choose subset
aTB <- cityT %>%
       filter(City=="Boston") %>%
       group_by(year, month)

# month trend for different year
ggplot(aTB, aes(x=month, y=AverageTemperature)) +
  geom_jitter(aes(colour=year)) + ggtitle("Boston Temperature by Month and Year") +
  labs(x="Month", y="Average Temperature")

# year trend for different month
ggplot(aTB, aes(x=year, y=AverageTemperature)) +
  geom_jitter(aes(colour=factor(month))) + ggtitle("Boston Temperature by Month and Year") +
  labs(x="Month", y="Average Temperature")
```
6. Selected each Janunary of year 1900-2012 of Boston city
Plot to see how does temperature change
```{r}
BostonT<- cityT %>% filter(City == "Boston")
bostonjan<-BostonT %>% filter(month == 1)
ggplot(bostonjan, aes(x=year, y=AverageTemperature))+geom_line(colour="pink")
```
7. Heatmap for 5 major Cities: Chicago, Boston, New York, Seattle, Los Angeles

```{r}
# choose the subset
hm <- cityT %>% 
        group_by(month, City) %>%
        summarise(temp=mean(AverageTemperature)) %>%
        filter(City=="Boston" | City=="Chicago" | City=="Los Angeles" | City=="New York" | City=="Seattle")

# Heatmap
ggplot(hm, aes(x=month, y=City, fill=temp, frame=City)) +
  geom_tile(color="white", size=0.1) +
  scale_fill_gradient(name="Average Temperature", low="white", high="red") +
  coord_equal() +
  labs(x = "Months", y = "", title = "Average Temp from 1900 - 2012") +
  theme_tufte() +
  theme(axis.ticks = element_blank()) +
  theme(axis.text = element_text(size = 14)) +
  theme(plot.title = element_text(size = 15)) +
  theme(legend.title = element_text(size = 15)) +
  theme(legend.text = element_text(size = 10))
```

8.Temperature trend by seasons
```{r}
s <- function(m){
            factor((m %% 12) %/% 3, labels = c('Winter', 'Spring', 'Summer', 'Autumn'))}

par(mfrow=c(1,2))
# US Tempreture by Season from 1900 to 2012
sus <- cityT %>%
       group_by(year, season=s(month)) %>%
       summarise(temp=mean(AverageTemperature))

sus %>%
    ggplot(mapping=aes(x=year, y=temp)) +
     geom_line(mapping = aes(color=season)) +
     theme_bw() + labs(x="Year", y="Average Temperature", title="US Season Temperature 1900-2012")

# Boston Tempreture by Season from 1900 to 2012
sbo <- cityT %>%
       filter(City=="Boston") %>%
       group_by(year, season=s(month)) %>%
       summarise(temp=mean(AverageTemperature))

sbo %>%
    ggplot(mapping=aes(x=year, y=temp)) +
     geom_line(mapping = aes(color=season)) +
     theme_bw() + labs(x="Year", y="Average Temperature", title="Boston Season Temperature 1900-2012")
```

